package db;

import java.io.BufferedInputStream;
import java.io.FileInputStream;
import java.io.IOException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.util.Properties;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;

// DB연결 객체 생성
public class DBConnection { 
	private String driver, url, user, passwd;
	private static final String
	  FILE="C:\\NCS\\jsp\\workspace(jsp)\\chap06_ConnPool\\src\\db\\dbconnect.properties";
	public Connection con = null;
	
	// 생성자 
	public DBConnection() throws IOException{
		Properties prop = new Properties();
		FileInputStream fis = new 
				FileInputStream(FILE);
		prop.load(new BufferedInputStream(fis));
		driver = prop.getProperty("driver");
		url = prop.getProperty("url");
		user = prop.getProperty("username");
		passwd = prop.getProperty("password");
		
		try{
			   // 커넥션 풀 작업순서
			   // 1. JNDI(Java Naming Directory Interface)에 
			   //    접근하기 위한 객체 생성
		       Context init = new InitialContext();
			   // 2. Context.xml 파일에 설정된 리소스를 참조하여 
			   //    DataSource 객체를 생성한다.
		       DataSource ds = 
		         (DataSource)init.lookup("java:comp/env/jdbc/orcl");
			   // 3. 커넥션 풀에  의한 DB 연동 객체 생성하여 연결시도
		       con = ds.getConnection(); // 커넥션 풀에서 객체 가져옴      
		       out.println("<h3> DBCP에 연결되었습니다.</h3>");
		   }catch(Exception e){
			   out.println("<h3> 연결에 실패하였습니다. </h3>");
		   }
	}// 생성자 end
	

}






